@page "/referrals"
@using Shared.DTOs.CRM
@using Shared.DTOs.Scheduling
@using Client.Pages.Components.TabComponents
@using ComposedHealthBase.BaseClient.Services
@inject ILazyLookupService<ReferralDto> ReferralLookupService
@attribute [Authorize]

<PageTitle>Referrals</PageTitle>

<MudText Typo="Typo.h1">Referrals</MudText>

<MudPaper Class="pa-4" Elevation="2">
    <ReferralsTab Referrals="referrals" OnSave="SaveReferral" />
</MudPaper>

@code {
    private List<ReferralDto> referrals = new();
    protected override async Task OnInitializedAsync()
    {
        await LoadReferrals();
    }

    private async Task LoadReferrals()
    {
        referrals = (await ReferralLookupService.GetAllItems(CancellationToken.None)).ToList();
    }

    private async Task SaveReferral(ReferralDto referral)
    {
        if (referral == null) return;
        if (referral.Id == Guid.Empty)
        {
            await ReferralLookupService.AddItem(referral, CancellationToken.None);
        }
        else
        {
            await ReferralLookupService.UpdateItem(referral, CancellationToken.None);
        }
    }
}
